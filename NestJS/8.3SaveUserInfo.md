# íšŒì› ê°€ì…ì„ ìš”ì²­í•œ ìœ ì €ì˜ ì •ë³´ ì €ì¥í•˜ê¸°

ì´ì œ íšŒì› ê°€ì… ìš”ì²­ì„ ë°›ì•˜ì„ ë•Œ íšŒì› ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ë„ë¡ í•˜ì.  
NestëŠ” ë¦¬í¬ì§€í† ë¦¬ íŒ¨í„´ì„ ì§€ì›í•œë‹¤.  
ë¨¼ì € ìœ ì € ì—”í‹°í‹°ë¥¼ ì •ì˜í•´ë³´ì.

- user.entity.ts

```typescript
import { Column, Entity, PrimaryColumn } from 'typeorm';

@Entity('User')
export class UserEntity {
  @PrimaryColumn()
  id: string;

  @Column({ length: 30 })
  name: string;

  @Column({ length: 60 })
  email: string;

  @Column({ length: 30 })
  password: string;

  @Column({ length: 60 })
  signupVerifyToken: string;
}
```

ì´ì œ ì´ ìœ ì € ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ TypeOrmModuleOptionsì˜ entities ì†ì„±ì˜ ê°’ìœ¼ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

```typescript
@Module({
  imports: [
    TypeOrmModule.forRoot({
            ...
      entities: [UserEntity],
            ...
    }),
  ],
})
export class AppModule {}
```

ìš°ë¦¬ëŠ” ì´ë¯¸ dist ë””ë ‰í† ë¦¬ ë‚´ì˜ .entity.ts ë˜ëŠ” .entity.jsë¡œ ëë‚˜ëŠ” íŒŒì¼ëª…ì„ ê°€ì§„ ì†ŒìŠ¤ì½”ë“œë¥¼ ì°¸ì¡°í•˜ë„ë¡ í•´ ë‘ì—ˆê¸° ë•Œë¬¸ì— ë³„ë‹¤ë¥¸ êµ¬í˜„ì´ í•„ìš”ì—†ë‹¤.  

```typescript
{
    ...
  "entities": ["dist/**/*.entity{.ts,.js}"],
  ...
}
```

ì´ì œ ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ êµ¬ë™ì‹œí‚¤ë©´ User í…Œì´ë¸”ì´ ìƒì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” synchronize ì˜µì…˜ì´ trueë¡œ ì„¤ì • ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

![í…Œì´ë¸”ì™„ì„±ëœì‚¬ì§„](//TODO)

User í…Œì´ë¸”ì´ ì¤€ë¹„ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ì´ì œ TODOë¡œ ë‚¨ê²¨ë†“ê³  ì§€ë‚˜ì˜¨ ì„œë¹„ìŠ¤ë‚´ í•¨ìˆ˜ë“¤ì„ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ì.

```typescript
...
import { TypeOrmModule } from '@nestjs/typeorm';
import { UserEntity } from './entity/user.entity';

@Module({
  imports: [
        ...
        TypeOrmModule.forFeature([UserEntity]),
    ],
    ...
})
export class UsersModule {}
```

L8: UsersModuleì—ì„œ forFeature() ë©”ì†Œë“œë¡œ ìœ ì € ëª¨ë“ˆ ë‚´ì—ì„œ ì‚¬ìš©í•  ì €ì¥ì†Œë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

```typescript
...
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { UserEntity } from './entity/user.entity';

export class UsersService {
  constructor(
        ...
    @InjectRepository(UserEntity) private usersRepository: Repository<UserEntity>,
  ) { }
    ...
}
```

L9: UsersSeviceì— @InjectRepository() ë°ì½”ë ˆì´í„°ë¡œ ìœ ì € ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.

```typescript
private async saveUser(name: string, email: string, password: string, signupVerifyToken: string) {
  const user = new UserEntity();
  user.id = ulid();
  user.name = name;
  user.email = email;
  user.password = password;
  user.signupVerifyToken = signupVerifyToken;
  await this.usersRepository.save(user);
}
```

L2: ìƒˆë¡œìš´ ìœ ì € ì—”í‹°í‹° ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

L3~L7: ì¸ìë¡œ ì „ë‹¬ë°›ì€ ìœ ì € ì •ë³´ë¥¼ ì—”í‹°í‹°ì— ì„¤ì •í•©ë‹ˆë‹¤.

L8: ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤.

> ğŸ’¡ ì—”í„°í‹°ì˜ idëŠ” ë³´í†µ ìˆ«ìë¡œ ë§ì´ ì‚¬ìš©í•˜ì§€ë§Œ ì´ ì±…ì—ì„œëŠ” stringìœ¼ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.
ëœë¤í•œ ìŠ¤íŠ¸ë§ì„ ìƒì„±í•˜ê¸° ìœ„í•´ ulid ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. $ npm i ulid ëª…ë ¹ì–´ë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.

ìœ ì € ìƒì„± APIë¥¼ í˜¸ì¶œí•˜ë©´ DBì— ì €ì¥ì´ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![ìœ ì €ìƒì„±í›„ë””ë¹„ì—ì €ì¥ë˜ëŠ”ì‚¬ì§„](//TODO)

ê¸°ì¡´ ìœ ì € ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ë„ êµ¬í˜„í•´ë³´ì.

```typescript
private async checkUserExists(emailAddress: string): Promise<boolean> {
  const user = await this.usersRepository.findOne({ email: emailAddress });

  return user !== undefined;
}
```

ë§Œì•½ ìœ ì € ìƒì„±ì‹œ í•´ë‹¹ ì´ë©”ì¼ë¡œ ê°€ì…í•œ ìœ ì €ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´ 42 ì—ëŸ¬ë¥¼ ë‚´ë„ë¡ í•˜ì.

```typescript
async createUser(name: string, email: string, password: string) {
  const userExist = await this.checkUserExists(email);
  if (userExist) {
    throw new UnprocessableEntityException('í•´ë‹¹ ì´ë©”ì¼ë¡œëŠ” ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
    ...
}
```