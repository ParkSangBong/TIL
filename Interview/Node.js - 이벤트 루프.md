# 이벤트 루프

## 이벤트 루프는 시스템 커널에서 가능한 작업이 있다면 해당 작업을 커널에 이관한다. 자바스크립트가 단일 스레드 기반임에도 불구하고 Node.js가 논 블로킹 I/O 작업을 수행할 수 있도록 해주는 핵심기능이다.

### 이벤트 루프에는 6개의 단계가 있다.

![](https://wikidocs.net/images/page/158474/2-2.png)

### 그림에서 루프를 이루고 있는 부분, 네모박스로 표시된 것들이다.

### 각 단계는 단계마다 처리해야 하는 콜백 함수를 담기 위한 큐를 가지고 있다. 화살표는 각 단계가 전이되는 방향을 뜻하지만 반드시 다음 단계로 넘어가는 것은 아니다.

### 자바스크립트 코드는 idle, prepare 단계를 제외한 어느 단계에서나 실행될 수 있다. 

### `nextTickQueue`와 `microTaskQueue`는 이벤트 루프의 구성요소는 아니며 이 큐에 들어 있는 작업 역시 이벤트 루프가 어느 단계에 있든지 실행될 수 있다.

### node main.js 명령어로 Node.js 애플리케이션을 콘솔에서 실행하면 Node.js는 먼저 이벤트 루프를 생성한 다음 메인 모듈인 main.js를 실행한다. 이 과정에서 생성된 콜백들이 각 단계에 존재한튼 큐에 들어가게 되는데 메인 모듈의 실행을 완료한 다음 이벤트 루프를 계속 실행할 지 결정한다. 만약 큐가 모두 비어서 더 이상 수행할 작업이 없다면 Node.js는 루프를 빠져 나가고 프로세스를 종료한다.
